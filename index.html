<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¯ã‚¤ã‚ºå¤§ä¼š å¾—ç‚¹ç®¡ç†</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    padding: 20px;
}
h1 { text-align: center; }

.box {
    background: white;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 10px;
    text-align: center;
}

input {
    padding: 6px;
    font-size: 16px;
    margin: 4px;
}

button {
    font-size: 16px;
    padding: 6px 10px;
    margin: 2px;
    cursor: pointer;
}

.team {
    background: white;
    padding: 12px;
    margin-bottom: 8px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.rank { width: 35px; font-size: 22px; text-align: center; }
.score { width: 50px; font-size: 22px; text-align: center; }

.admin-only { display: none; }
.delete { background:#ffd6d6; }
</style>
</head>
<body>

<h1>ğŸ† ã‚¯ã‚¤ã‚ºå¤§ä¼š å¾—ç‚¹è¡¨</h1>

<div class="box">
    <p id="status">æ¥ç¶šä¸­â€¦</p>
</div>

<div class="box" id="loginBox" style="display:none;">
    <input id="adminId" placeholder="ç®¡ç†è€…ID">
    <input id="adminPw" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button id="loginBtn">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
    <p id="loginMsg"></p>
</div>

<div id="teams"></div>

<div class="box admin-only">
    <button id="addBtn">ï¼‹ ãƒãƒ¼ãƒ è¿½åŠ </button>
    <button id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<script>
/* ===== è¨­å®šï¼ˆã“ã“ã ã‘å¤‰æ›´ï¼‰ ===== */
const WS_URL = "wss://quiz-d3rz.onrender.com/";
/* =============================== */

const statusEl = document.getElementById("status");
const loginBox = document.getElementById("loginBox");
const loginMsg = document.getElementById("loginMsg");
const teamsDiv = document.getElementById("teams");

const loginBtn = document.getElementById("loginBtn");
const addBtn   = document.getElementById("addBtn");
const resetBtn= document.getElementById("resetBtn");

let ws;
let isAdmin = false;
let teams = [];

/* ===== æ¥ç¶š ===== */
ws = new WebSocket(WS_URL);

ws.onopen = () => {
    statusEl.textContent = "æ¥ç¶šæˆåŠŸ";
    loginBox.style.display = "block";
};

ws.onerror = () => {
    statusEl.textContent = "æ¥ç¶šå¤±æ•—";
};

ws.onmessage = e => {
    const data = JSON.parse(e.data);

    if (data.type === "update") {
        teams = data.teams;
        render();
    }

    if (data.type === "admin") {
        if (data.success) {
            isAdmin = true;
            loginMsg.textContent = "ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ";
            document.querySelectorAll(".admin-only")
                .forEach(e => e.style.display = "block");
            render();
        } else {
            loginMsg.textContent = "IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
        }
    }
};

function send(obj) {
    if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify(obj));
    }
}

/* ===== ç®¡ç†è€…æ“ä½œ ===== */
loginBtn.onclick = () => {
    send({
        type: "login",
        id: adminId.value,
        password: adminPw.value
    });
};

addBtn.onclick = () => send({ type: "addTeam" });
resetBtn.onclick = () => send({ type: "reset" });

function deleteTeam(i) {
    if (confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        send({ type: "deleteTeam", index: i });
    }
}

/* ===== è¡¨ç¤º ===== */
function render() {
    teamsDiv.innerHTML = "";

    const sorted = teams
        .map((t,i)=>({...t,index:i}))
        .sort((a,b)=>b.score - a.score);

    sorted.forEach((t,r) => {
        const medal = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][r] || (r+1);
        const div = document.createElement("div");
        div.className = "team";
        div.innerHTML = `
            <div class="rank">${medal}</div>
            <input value="${t.name}" ${!isAdmin?"disabled":""}
                onchange="teams[${t.index}].name=this.value; send({type:'update',teams})">
            <button ${!isAdmin?"disabled":""}
                onclick="teams[${t.index}].score--; send({type:'update',teams})">âˆ’</button>
            <div class="score">${t.score}</div>
            <button ${!isAdmin?"disabled":""}
                onclick="teams[${t.index}].score++; send({type:'update',teams})">ï¼‹</button>
            ${isAdmin ? `<button class="delete" onclick="deleteTeam(${t.index})">ğŸ—‘</button>` : ""}
        `;
        teamsDiv.appendChild(div);
    });
}
</script>

</body>
</html>
